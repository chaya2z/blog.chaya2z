{"pageProps":{"postData":{"id":"post01","year":"2021","month":"12","date":"04","contentHtml":"<p>この記事は <a href=\"https://adventar.org/calendars/6368\">ITRC Advent Calendar 2021</a> の4日目の記事です．</p>\n<p>前日は <a href=\"https://twitter.com/saba383810\">@saba</a> の <a href=\"https://sabanogames.com/tips/305/\">【Unity】重い処理はメインスレッド以外の別スレッドで動かそう！！【非同期処理】</a> でした．</p>\n<p>次は <a href=\"https://twitter.com/gamoutatsumi\">@waka</a> の <a href=\"https://zenn.dev/gamoutatsumi/articles/26745357cffa44\">最近のVim事情</a> です．</p>\n<h2 id=\"目次\">目次</h2>\n<ul>\n<li><a href=\"#1-conoha-%E3%81%AE-vps-%E3%82%92%E5%A5%91%E7%B4%84%E3%81%97%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E5%BB%BA%E3%81%A6%E3%82%8B\">1. ConoHa の VPS を契約しサーバを建てる</a></li>\n<li><a href=\"#2-%E3%82%A6%E3%82%A7%E3%83%96%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E5%BB%BA%E3%81%A6%E3%81%A6-iso-%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B\">2. ウェブサーバを建てて ISO イメージを公開する</a></li>\n<li><a href=\"#3-conoha%E3%81%ABiso-%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B\">3. ConoHaにISO イメージをダウンロードする</a></li>\n<li><a href=\"#4--1--%E3%81%A7%E5%BB%BA%E3%81%A6%E3%81%9F%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AB-iso-%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E6%8C%BF%E5%85%A5%E3%81%99%E3%82%8B\">4. ( 1 ) で建てたサーバに ISO イメージを挿入する</a></li>\n<li><a href=\"#5-vyos-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\">5. VyOS をインストールする</a></li>\n<li><a href=\"#6-iso-%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E6%8E%92%E5%87%BA%E3%81%99%E3%82%8B\">6. ISO イメージを排出する</a></li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83\">参考</a></li>\n</ul>\n<h2 id=\"1-conoha-の-vps-を契約しサーバを建てる\">1. ConoHa の VPS を契約しサーバを建てる</h2>\n<p>OS は何でもいい<sup><a href=\"#user-content-fn-1\" id=\"user-content-fnref-1\" data-footnote-ref aria-describedby=\"footnote-label\">1</a></sup> のでサーバを契約します．</p>\n<h2 id=\"2-ウェブサーバを建てて-iso-イメージを公開する\">2. ウェブサーバを建てて ISO イメージを公開する</h2>\n<p><a href=\"https://qiita.com/marukei/items/6b6ccee3e7a553f64f1e\">https://qiita.com/marukei/items/6b6ccee3e7a553f64f1e</a></p>\n<p>この記事によると ConoHa の VPS では ISO イメージのダウンロードに http 接続しか使えないみたいです．</p>\n<p>VyOS の ISO イメージは https で配布されているので，http 接続のためにウェブサーバを建てる必要があります．自分でビルドする場合も同じです．</p>\n<h3 id=\"21-nginxでウェブサーバを建てる\">2.1 nginxでウェブサーバを建てる</h3>\n<ol>\n<li>nginx のインストール</li>\n</ol>\n<pre style=\"background: #2e3440\"><code class=\"language-bash\"><span style=\"color: #D8DEE9FF\">sudo apt update</span>\n<span style=\"color: #D8DEE9FF\">sudo apt install nginx -y</span>\n</code></pre>\n<ol start=\"2\">\n<li>ISO イメージファイルの公開</li>\n</ol>\n<pre style=\"background: #2e3440\"><code class=\"language-bash\"><span style=\"color: #88C0D0\">cd</span><span style=\"color: #D8DEE9FF\"> /var/www/html</span>\n<span style=\"color: #D8DEE9FF\">sudo wget https://downloads.vyos.io/rolling/current/amd64/vyos-rolling-latest.iso</span>\n</code></pre>\n<ol start=\"3\">\n<li>ISO イメージファイルにアクセスできるようにする</li>\n</ol>\n<p>Nginx のデフォルト設定では，ブラウザから <code>/vyos*.iso</code> にアクセスしても ISO イメージファイルにアクセスできません．</p>\n<p><code>/etc/nginx/nginx.conf</code> を編集します．</p>\n<p><code>http</code> ディレクティブに <code>server</code> ディレクティブを追加します．</p>\n<pre style=\"background: #2e3440\"><code style=\"color: undefined\">http {\n    \n    ...\n    \n    server {\n        location / {\n            try_files $uri $uri/ =404;\n        }\n    }\n}\n</code></pre>\n<p>こうすると，ブラウザから <code>/vyos*.iso</code> にアクセスしたときにそのファイルがあるか探し，存在しなければ404を返すようになります．</p>\n<h2 id=\"3-conohaにiso-イメージをダウンロードする\">3. ConoHaにISO イメージをダウンロードする</h2>\n<h3 id=\"31-conoha-iso-を使う\">3.1 conoha-iso を使う</h3>\n<p>conoha-iso は，ISO イメージのダウンロードを簡単に行えるツールです．ツールのダウンロードは以下のページの手順を参考にします．</p>\n<p><a href=\"https://support.conoha.jp/v/clitools/\">https://support.conoha.jp/v/clitools/</a></p>\n<h3 id=\"32-conoha-iso-の確認\">3.2 conoha-iso の確認</h3>\n<pre style=\"background: #2e3440\"><code style=\"color: undefined\">./conoha-iso list -u [APIユーザ名] \\\n                  -p [APIパスワード] \\\n                  -n [テナント名] \\\n                  -r [リージョン]\n</code></pre>\n<p>ISO イメージのダウンロードが初めてなら，ISO イメージは空なので <code>No ISO images</code> と返ってきます．</p>\n<h3 id=\"33-iso-イメージのダウンロード\">3.3 ISO イメージのダウンロード</h3>\n<p>(2) で建てたウェブサーバからISOイメージをダウンロードします．</p>\n<pre style=\"background: #2e3440\"><code style=\"color: undefined\">./conoha-iso download -i http://{ConoHaのサーバのIP}/{vyosのISOイメージのファイル名} \\\n                      -u [APIユーザ名] \\\n                      -p [APIパスワード] \\\n                      -n [テナント名] \\\n                      -r [リージョン]\n</code></pre>\n<p>もう一度上記の <code>./conoha-iso list</code> コマンドを使い，ISO イメージが追加されたか確認します．</p>\n<h2 id=\"4--1--で建てたサーバに-iso-イメージを挿入する\">4. ( 1 ) で建てたサーバに ISO イメージを挿入する</h2>\n<p><code>./conoha-iso insert</code> コマンドで ISO イメージを挿入します．これは，ISO を焼いた USB メモリをサーバに挿した状態と同じです．</p>\n<h2 id=\"5-vyos-をインストールする\">5. VyOS をインストールする</h2>\n<p>VyOS のインストーラが立ち上がるのでインストールします．</p>\n<pre style=\"background: #2e3440\"><code style=\"color: undefined\">install image\npoweroff\n</code></pre>\n<h2 id=\"6-iso-イメージを排出する\">6. ISO イメージを排出する</h2>\n<p><code>./conoha-iso eject</code> コマンドで ISO イメージを排出します．</p>\n<h2 id=\"まとめ\">まとめ</h2>\n<p>この手順でなら任意の ISO イメージを使ったサーバ作成が可能です。</p>\n<p>ただ，ここまでするなら別の VPS 使ったほうがいいですね... 無料お試しサービスがあればそれを使いましょう．</p>\n<h2 id=\"参考\">参考</h2>\n<p>ConoHaのドキュメント．全体の流れはここを参照．\n<a href=\"https://support.conoha.jp/v/clitools/\">https://support.conoha.jp/v/clitools/</a></p>\n<p>ウェブサーバを建ててISOイメージをダウンロードするアイデアはここから．\n<a href=\"https://himakan.net/program/conoha-vps-install-rancheros\">https://himakan.net/program/conoha-vps-install-rancheros</a></p>\n<p>nginxの公式ドキュメント．locationの書き方はここを参照．\n<a href=\"https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/\">https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/</a></p>\n<section data-footnotes class=\"footnotes\"><h2 id=\"footnote-label\" class=\"sr-only\">Footnotes</h2>\n<ol>\n<li id=\"user-content-fn-1\">\n<p>Ubuntu 20.04 で確認済み．ウェブサーバが建てられればなんでもいい． <a href=\"#user-content-fnref-1\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\">↩</a></p>\n</li>\n</ol>\n</section>","title":"ConoHa-VPSにVyOSをインストールする","created_at":"2021-12-04"}},"__N_SSG":true}